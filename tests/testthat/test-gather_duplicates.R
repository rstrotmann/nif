test_that("gather_duplicates works in common case", {
  obj <- tibble::tribble(
  ~ID, ~USUBJID, ~ANALYTE, ~EVID, ~DOSE, ~AMT, ~TIME, ~NTIME, ~DV, ~CMT,
    1,      "1",   "DRUG",     0,   100,    0,    -1,      0,   0,    1,
    1,      "1",   "DRUG",     1,   100,  100,     0,      1,   0,    0,
    1,      "1",   "DRUG",     0,   100,    0,     0,      0,   0,    1,
    1,      "1",   "DRUG",     0,   100,    0,     1,      2,   1,    1,
    1,      "1",   "DRUG",     0,   100,    0,     2,      2,   2,    1,
    1,      "1",   "DRUG",     0,   100,    0,     4,      4,   4,    1,

    1,      "1",     "QT",     0,   100,    0,     0,      0, 450,    2,
    1,      "1",     "QT",     0,   100,    0,   0.1,      0, 451,    2,
    1,      "1",     "QT",     0,   100,    0,   0.2,      0, 452,    2,

    1,      "1",     "QT",     0,   100,    0,     1,      1, 455,    2,
    1,      "1",     "QT",     0,   100,    0,   1.1,      1, 456,    2,
    1,      "1",     "QT",     0,   100,    0,   1.2,      1, 457,    2,

    1,      "1",     "QT",     0,   100,    0,     2,      2, 460,    2,
    1,      "1",     "QT",     0,   100,    0,   2.1,      2, 461,    2,
    1,      "1",     "QT",     0,   100,    0,   2.2,      2, 462,    2,

    1,      "1",     "HR",     0,   100,    0,     0,      0, 50,    3,
    1,      "1",     "HR",     0,   100,    0,   0.1,      0, 51,    3,
    1,      "1",     "HR",     0,   100,    0,   0.2,      0, 52,    3,

    1,      "1",     "HR",     0,   100,    0,     1,      1, 55,    3,
    1,      "1",     "HR",     0,   100,    0,   1.1,      1, 56,    3,
    1,      "1",     "HR",     0,   100,    0,   1.2,      1, 57,    3,

    1,      "1",     "HR",     0,   100,    0,     2,      2, 60,    3,
    1,      "1",     "HR",     0,   100,    0,   2.1,      2, 61,    3,
    1,      "1",     "HR",     0,   100,    0,   2.2,      2, 62,    3
  ) |>
    nif()

  result <- as.data.frame(gather_duplicates(obj, silent = F))

})
