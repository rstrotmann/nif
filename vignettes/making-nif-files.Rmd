---
title: "Making nif data sets from SDTM data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Making nif data sets from SDTM data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette goes through an example of creating a nif object for a single
ascending dose study with the drug "examplinib". The sdtm data for this study
are provided as part of the package.

This vignette makes use of the following packages:

```{r setup, message = FALSE, warning = FALSE}
library(dplyr)
library(knitr)
library(nif)
```

# SDTM DATA

Looking at the summary of the sdtm, there is one treatment, 'EXAMPLINIB', and
two analytes, "RS2023", the parent compound, and "RS2023487A", its metabolite:

```{r}
sdtm <- examplinib_sad
summary(sdtm)
```
# CREATING A NIF DATASET 

The generation of a NIF object starts with an empty nif object (`new_nif()`), 
and we sequentially add the administrations, observations, and baseline columns.

the 

```{r}
nif <- new_nif() %>% 
  add_administration(sdtm, "EXAMPLINIB", analyte = "RS2023") %>% 
  add_observation(sdtm ,"pc", "RS2023", cmt = 2) %>% 
  add_observation(sdtm, "pc", "RS2023487A", parent = "RS2023", cmt = 3) %>% 
  add_baseline(sdtm, "lb", "CREAT") %>% 
  add_bl_crcl() %>% 
  add_bl_renal()

nif %>% head()
```

# DATA EXPLORATION

To get an overview of the NIF object, we can summarize it, and plot the summary
for a graphical representation of the baseline characteristics of the
population and the analytes:

```{r fig.width=3, fig.height=3}
summary(nif)

invisible(capture.output(
  plot(summary(nif))
))
```

Specific analytes can be plotted using `plot`. After non-compartmental analysis
of PK data with rich sampling, both tabular and graphical analyses are
supported:

```{r fig.width=6, fig.height=4}
nif %>% 
  plot("RS2023", log = T, points = T, title = "Parent concentrations")
```

```{r fig.height=3, fig.width=3}
nca <- nif %>% 
  nca(analyte = "RS2023")

nca %>% 
  nca_summary_table() %>% 
  kable(caption = "RS2023 PK parameters")

invisible(capture.output(
  nca %>% 
  nca_power_model()
))
```

```{r fig.width=6, fig.height=4}
nif %>% 
  plot("RS2023487A", log = T, points = T, title = "Metabolite concentrations")
```

