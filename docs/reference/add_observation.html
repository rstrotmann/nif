<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add observation events to nif — add_observation • nif</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add observation events to nif — add_observation"><meta name="description" content="Add rows to a nif object that represent observation events, i.e., with
EVID values of 0. This is usually the second step in the creation of NIF data
tables, after add_administration()."><meta property="og:description" content="Add rows to a nif object that represent observation events, i.e., with
EVID values of 0. This is usually the second step in the creation of NIF data
tables, after add_administration()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">nif</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.64.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/nif.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/multiple-dose-example.html">Example: Multiple-dose study</a></li>
    <li><a class="dropdown-item" href="../articles/nif-formulas.html">Data definition using formulas</a></li>
    <li><a class="dropdown-item" href="../articles/nif-imputations.html">Imputations and assumptions</a></li>
    <li><a class="dropdown-item" href="../articles/importing-nif-data.html">Importing NIF data sets</a></li>
    <li><a class="dropdown-item" href="../articles/pharmaverse-example.html">Example: Pharmaverse SDTM data</a></li>
    <li><a class="dropdown-item" href="../articles/multiple-study-example.html">More than one study in a NIF dataset</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/rstrotmann/nif/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Add observation events to nif</h1>
      <small class="dont-index">Source: <a href="https://github.com/rstrotmann/nif/blob/HEAD/R/nif_observations.R" class="external-link"><code>R/nif_observations.R</code></a></small>
      <div class="d-none name"><code>add_observation.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Add rows to a <a href="nif.html">nif</a> object that represent observation events, i.e., with
EVID values of 0. This is usually the second step in the creation of NIF data
tables, after <code><a href="add_administration.html">add_administration()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">add_observation</span><span class="op">(</span></span>
<span>  <span class="va">nif</span>,</span>
<span>  <span class="va">sdtm</span>,</span>
<span>  <span class="va">domain</span>,</span>
<span>  <span class="va">testcd</span>,</span>
<span>  analyte <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  parent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  metabolite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  cmt <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  subject_filter <span class="op">=</span> <span class="st">"!ACTARMCD %in% c('SCRNFAIL', 'NOTTRT')"</span>,</span>
<span>  observation_filter <span class="op">=</span> <span class="st">"TRUE"</span>,</span>
<span>  cat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  scat <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  testcd_field <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dtc_field <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  dv_field <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  coding_table <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  factor <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  ntime_lookup <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ntime_method <span class="op">=</span> <span class="st">"TPT"</span>,</span>
<span>  keep <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  debug <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  include_day_in_ntime <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  silent <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  duplicates <span class="op">=</span> <span class="st">"stop"</span>,</span>
<span>  duplicate_function <span class="op">=</span> <span class="va">mean</span>,</span>
<span>  duplicate_identifier <span class="op">=</span> <span class="st">"DTC"</span>,</span>
<span>  omit_not_done <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  na_rm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  na_to_zero <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-nif">nif<a class="anchor" aria-label="anchor" href="#arg-nif"></a></dt>
<dd><p>A nif object.</p></dd>


<dt id="arg-sdtm">sdtm<a class="anchor" aria-label="anchor" href="#arg-sdtm"></a></dt>
<dd><p>A sdtm object. Needs at least the 'DM' and 'VS' domains, and the
domain the observations come from.</p></dd>


<dt id="arg-domain">domain<a class="anchor" aria-label="anchor" href="#arg-domain"></a></dt>
<dd><p>The domain as character.</p></dd>


<dt id="arg-testcd">testcd<a class="anchor" aria-label="anchor" href="#arg-testcd"></a></dt>
<dd><p>The observation variable, as character.</p></dd>


<dt id="arg-analyte">analyte<a class="anchor" aria-label="anchor" href="#arg-analyte"></a></dt>
<dd><p>The name for the analyte. Defaults to the 'testcd', if NULL.</p></dd>


<dt id="arg-parent">parent<a class="anchor" aria-label="anchor" href="#arg-parent"></a></dt>
<dd><p>The name of the parent analyte for the observation as
character. Defaults to the respective treatment administered before the
observation, if NULL.</p></dd>


<dt id="arg-metabolite">metabolite<a class="anchor" aria-label="anchor" href="#arg-metabolite"></a></dt>
<dd><p>Observation is a metabolite, as logical.</p></dd>


<dt id="arg-cmt">cmt<a class="anchor" aria-label="anchor" href="#arg-cmt"></a></dt>
<dd><p>The compartment for the observation as numeric.</p></dd>


<dt id="arg-subject-filter">subject_filter<a class="anchor" aria-label="anchor" href="#arg-subject-filter"></a></dt>
<dd><p>The filtering to apply to the DM domain.</p></dd>


<dt id="arg-observation-filter">observation_filter<a class="anchor" aria-label="anchor" href="#arg-observation-filter"></a></dt>
<dd><p>The filtering to apply to the observation source
data.</p></dd>


<dt id="arg-cat">cat<a class="anchor" aria-label="anchor" href="#arg-cat"></a></dt>
<dd><p>xxCAT filter to apply, as character.</p></dd>


<dt id="arg-scat">scat<a class="anchor" aria-label="anchor" href="#arg-scat"></a></dt>
<dd><p>xxSCAT filter to apply, as character.</p></dd>


<dt id="arg-testcd-field">testcd_field<a class="anchor" aria-label="anchor" href="#arg-testcd-field"></a></dt>
<dd><p>The xxTESTCD field. Defaults to the two-character domain
name followed by 'TESTCD', if NULL.</p></dd>


<dt id="arg-dtc-field">dtc_field<a class="anchor" aria-label="anchor" href="#arg-dtc-field"></a></dt>
<dd><p>The field to use as the date-time code for the observation.
Defaults to the two-character domain name followed by 'DTC', if NULL.</p></dd>


<dt id="arg-dv-field">dv_field<a class="anchor" aria-label="anchor" href="#arg-dv-field"></a></dt>
<dd><p>the field to use as the dependent variable. Defaults to the
two-character domain name followed by 'STRESN', if NULL.</p></dd>


<dt id="arg-coding-table">coding_table<a class="anchor" aria-label="anchor" href="#arg-coding-table"></a></dt>
<dd><p>Coding table to translate a categorical values into
numerical values, as data frame. The data frame must have at least one
column that matches a column in the domain, and a numerical 'DV' column
that provides the recoding result.</p></dd>


<dt id="arg-factor">factor<a class="anchor" aria-label="anchor" href="#arg-factor"></a></dt>
<dd><p>Multiplier for the DV field, as numeric.</p></dd>


<dt id="arg-ntime-lookup">ntime_lookup<a class="anchor" aria-label="anchor" href="#arg-ntime-lookup"></a></dt>
<dd><p>A data frame with two columns, a column that defines the
custom nominal time information in the target domain (e.g., 'PCELTM'), and
'NTIME'. This data frame is left_joined into the observation data frame
to provide the NTIME field.</p></dd>


<dt id="arg-ntime-method">ntime_method<a class="anchor" aria-label="anchor" href="#arg-ntime-method"></a></dt>
<dd><p>the field to derive the nominal time from. Allowed values
are 'TPT', 'TPTNUM', 'ELTM', 'VISITDY' and 'DY'. Defaults to xxTPT where xx
is the domain name.</p></dd>


<dt id="arg-keep">keep<a class="anchor" aria-label="anchor" href="#arg-keep"></a></dt>
<dd><p>Columns to keep, as character.</p></dd>


<dt id="arg-debug">debug<a class="anchor" aria-label="anchor" href="#arg-debug"></a></dt>
<dd><p>Include debug fields, as logical.</p></dd>


<dt id="arg-include-day-in-ntime">include_day_in_ntime<a class="anchor" aria-label="anchor" href="#arg-include-day-in-ntime"></a></dt>
<dd><p>as logical.</p></dd>


<dt id="arg-silent">silent<a class="anchor" aria-label="anchor" href="#arg-silent"></a></dt>
<dd><p>Suppress messages, as logical. Defaults to nif_option setting
if NULL.</p></dd>


<dt id="arg-duplicates">duplicates<a class="anchor" aria-label="anchor" href="#arg-duplicates"></a></dt>
<dd><p>Selection how to deal with duplicate observations with
respect to the USUBJID, ANALYTE and DTC fields:</p><ul><li><p>'stop': Stop execution and produce error message</p></li>
<li><p>'ignore': Include duplicates in the data set</p></li>
<li><p>'identify': Return a list of duplicate entries</p></li>
<li><p>'resolve': Resolve duplicates, applying the <code>duplicate_function</code> to the
duplicate entries.</p></li>
</ul></dd>


<dt id="arg-duplicate-function">duplicate_function<a class="anchor" aria-label="anchor" href="#arg-duplicate-function"></a></dt>
<dd><p>Function to resolve duplicate values, defaults to
<code>mean</code>.</p></dd>


<dt id="arg-duplicate-identifier">duplicate_identifier<a class="anchor" aria-label="anchor" href="#arg-duplicate-identifier"></a></dt>
<dd><p>Fields by which duplicates are identified (after
addition of the observations to the nif object), defaults to "DTC".
Consider also "NTIME", or any other custom field.</p></dd>


<dt id="arg-omit-not-done">omit_not_done<a class="anchor" aria-label="anchor" href="#arg-omit-not-done"></a></dt>
<dd><p>Delete rows where xxSTAT is "NOT DONE, as logical.</p></dd>


<dt id="arg-na-rm">na_rm<a class="anchor" aria-label="anchor" href="#arg-na-rm"></a></dt>
<dd><p>Logical indicating whether to remove NA values when applying the
duplicate_function. Defaults to TRUE.</p></dd>


<dt id="arg-na-to-zero">na_to_zero<a class="anchor" aria-label="anchor" href="#arg-na-to-zero"></a></dt>
<dd><p>Set all NA values of DV to 0, as logical.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A nif object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Observations can be pharmacokinetic observations (i.e., from the PC domain),
or any other type of observation from any other SDTM domain. The <code>domain</code> and
<code>testcd</code> arguments specify the source of the observation events.</p>
<p>In general, the dependent variable and the observation time stamp are taken
from the 'xxSTRESN' and 'xxDTC' fields of the source domain (where xx refers
to the domain code). Differing fields can be specified by the <code>dv_field</code> and
<code>dtc_field</code> arguments</p>
<p>Observation events can be attached to an administered drug by the <code>parent</code>
argument. Specifying the respective parent ANALYTE code links these
observations to the respective drug administration event. This is required
for the calculation of time-after-dose ('TAD') and time-after-first-dose
('TAFD') for observations. If no <code>parent</code> is specified, the most likely
parent is automatically selected. This usually works well for studies where
only one treatment is administered. In other cases, it may be beneficial to
explicitly define a parent for all observations.</p>
<p>Observations can be further specified with <code>cat</code> and <code>scat</code> arguments that
refer to the 'xxCAT' and 'xxSCAT' fields of the source domain (xx), and the
<code>observation_filter</code> argument. This may be necessary, when observations
defined by the <code>testcd</code> alone are ambiguous, e.g., when for pharmacokinetic
observations, both BLOOD and URINE observations are included in the PC domain
data.</p>
<p>A model compartment can be specified by the <code>cmt</code> argument, or will be
automatically assigned otherwise.</p><div class="section">
<h3 id="nominal-time">Nominal time<a class="anchor" aria-label="anchor" href="#nominal-time"></a></h3>


<p>While the actual time fields (i.e., TIME, TAFD, TAD) for the observation
events are automatically derived from the date-time stamp (the xxDTC field),
the nominal time of the observation is often not unambiguously represented in
the source SDTM data. Different methods are provided to derive the nominal
time (NTIME) field and can be selected using the <code>ntime_method</code> argument.</p><ul><li><p>'TPT' attempts to extract the nominal time from the 'xxTPT' field of the
SDTM data</p></li>
<li><p>'TPTNUM' interprets the 'xxTPTNUM' field as the numerical representation of
the
nominal observation time in hours. Note that depending on the SDTM generation
method, this may or may not be correct</p></li>
<li><p>'ELTM' uses the xxELTM (elapsed time) column, if available</p></li>
<li><p>'VISITDY' uses the VISIDY column to derive the nominal time. Note that the
(planned) visit day may differ from the actual day of the observation. As
this column has not time information, the granularity of the observation is
full days.</p></li>
<li><p>'DY' uses the 'xxDY' columns of the original SDTM data. As this
column has not time information, the granularity of the observation is full
days.</p></li>
</ul><p>Alternatively, a lookup table data frame can be provided by the
<code>ntime_lookup</code> argument that associates any column in the source SDTM data
with the respective NTIME.</p>
</div>

<div class="section">
<h3 id="recoding">Recoding<a class="anchor" aria-label="anchor" href="#recoding"></a></h3>


<p>For some observation types, the source SDTM data may not include a dependent
variable in numerical form (i.e., for AE observations when AETOXGR is
provided in text form). In such cases, a <code>coding_table</code> can be provided that
links the values of an arbitrary columns to the expected 'DV' value.</p>
</div>

<div class="section">
<h3 id="duplicate-observations">Duplicate observations<a class="anchor" aria-label="anchor" href="#duplicate-observations"></a></h3>


<p>SDTM data may contain duplicate observations, most often because of
incomplete data cleaning. <code>add_observation()</code> provides methods to deal
with duplicates, see the description of the <code>duplicates</code> argument.</p>
</div>

<div class="section">
<h3 id="further-information">Further information<a class="anchor" aria-label="anchor" href="#further-information"></a></h3>


<p>For an overview on the representation of observation events in NONMEM
Input Format compliant data sets, see Bauer, R.J. (2019), NONMEM Tutorial
Part I: Description of Commands and Options, With Simple Examples of
Population Analysis. CPT Pharmacometrics Syst. Pharmacol., 8: 525-537.
https://doi.org/10.1002/psp4.12404</p>
<p>To add administration events to the <a href="nif.html">nif</a> object, see
<code><a href="add_administration.html">add_administration()</a></code>.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="add_administration.html">add_administration()</a></code></p></div>
    </div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Rainer Strotmann.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

