# NIF

This is a package to create NONMEM Input Format (NIF) data tables from
SDTM-formatted clinical study data.

The [NONMEM](https://www.iconplc.com/solutions/technologies/nonmem)
software that is often used for population
pharmacokinetic/pharmacodynamic (PK/PD) modeling expects the input data
set to follow specific conventions summarized in *Bauer, R.J. (2019),
NONMEM Tutorial Part I: Description of Commands and Options, With Simple
Examples of Population Analysis. CPT Pharmacometrics Syst. Pharmacol.,
8: 525-537*. <https://doi.org/10.1002/psp4.12404>.

This package provides functions to sequentially aggregate drug
administrations, PK/PD observations and covariates into a
NONMEM-compliant analysis data set (NIF data set), and tools to explore
and visualize NIF data sets.

## Installation

You can install the development version of `nif` like this:

``` r
devtools::install_github("rstrotmann/nif", build_vignettes=TRUE)
```

## Example

### Generate a NIF data set

This is a very basic example using sample SDTM data from a fictional
single ascending dose study to create a NIF data set using `make_nif()`:

``` r
library(nif)
library(tidyverse)

sdtm <- examplinib_sad

nif <- new_nif() %>%
  add_administration(sdtm, "EXAMPLINIB", analyte = "RS2023") %>%
  add_observation(sdtm, "pc", "RS2023", analyte = "RS2023")

head(nif)
#>   REF ID    STUDYID           USUBJID AGE SEX  RACE HEIGHT WEIGHT     BMI
#> 1   1  1 2023000001 20230000011010001  43   0 WHITE  187.4     77 21.9256
#> 2   2  1 2023000001 20230000011010001  43   0 WHITE  187.4     77 21.9256
#> 3   3  1 2023000001 20230000011010001  43   0 WHITE  187.4     77 21.9256
#> 4   4  1 2023000001 20230000011010001  43   0 WHITE  187.4     77 21.9256
#> 5   5  1 2023000001 20230000011010001  43   0 WHITE  187.4     77 21.9256
#> 6   6  1 2023000001 20230000011010001  43   0 WHITE  187.4     77 21.9256
#>                   DTC TIME NTIME TAFD TAD EVID AMT ANALYTE CMT PARENT TRTDY
#> 1 2000-12-31 10:18:00  0.0   0.0  0.0 0.0    1   5  RS2023   1 RS2023     1
#> 2 2000-12-31 10:18:00  0.0   0.0  0.0 0.0    0   0  RS2023   2 RS2023     1
#> 3 2000-12-31 10:48:00  0.5   0.5  0.5 0.5    0   0  RS2023   2 RS2023     1
#> 4 2000-12-31 11:18:00  1.0   1.0  1.0 1.0    0   0  RS2023   2 RS2023     1
#> 5 2000-12-31 11:48:00  1.5   1.5  1.5 1.5    0   0  RS2023   2 RS2023     1
#> 6 2000-12-31 12:18:00  2.0   2.0  2.0 2.0    0   0  RS2023   2 RS2023     1
#>   METABOLITE DOSE MDV ACTARMCD IMPUTATION      DV
#> 1      FALSE    5   1       C1                 NA
#> 2      FALSE    5   0       C1             0.0000
#> 3      FALSE    5   0       C1            40.7852
#> 4      FALSE    5   0       C1            48.5530
#> 5      FALSE    5   0       C1            44.0391
#> 6      FALSE    5   0       C1            34.0729
```

In many cases, you may want to add further covariates, e.g., baseline
creatinine from the LB domain:

``` r
nif <- nif %>%
  mutate(COHORT = ACTARMCD) %>%
  add_baseline(sdtm, "lb", "CREAT") %>%
  add_bl_crcl()
#> baseline_filter for BL_CREAT set to LBBLFL == 'Y'
```

### Data exploration

The `nif` package provides a range of functions to explore and summarize
NIF files:

``` r
summary(nif)
#> ----- NONMEM Input Format (NIF) data summary -----
#> Data from 48 subjects across one study:
#>   STUDYID      N    
#>   2023000001   48    
#> 
#> Sex distribution:
#>   SEX      N    percent   
#>   male     48   100       
#>   female   0    0          
#> 
#> Renal impairment class:
#>   CLASS      N    percent   
#>   normal     42   87.5      
#>   mild       6    12.5      
#>   moderate   0    0         
#>   severe     0    0          
#> 
#> Treatments:
#>   RS2023
#> 
#> Analytes:
#>   RS2023
#> 
#> Subjects per dose level:
#>   COHORT   RS2023   N    
#>   C1       5        3    
#>   C10      500      12   
#>   C2       10       3    
#>   C3       20       3    
#>   C4       50       3    
#>   C5       100      6    
#>   C6       200      3    
#>   C7       500      6    
#>   C8       800      6    
#>   C9       1000     3     
#> 
#> 816 observations:
#>   CMT   ANALYTE   N     
#>   2     RS2023    816    
#> 
#> Sampling schedule:
#>   NTIME   RS2023   
#>   0       X        
#>   0.5     X        
#>   1       X        
#>   1.5     X        
#>   2       X        
#>   3       X        
#>   4       X        
#>   6       X        
#>   8       X        
#>   10      X        
#>   12      X        
#>   24      X        
#>   48      X        
#>   72      X        
#>   96      X        
#>   144     X        
#>   168     X         
#> 
#> Subjects with dose reductions
#>   RS2023   
#>   0         
#> 
#> Treatment duration overview:
#>   PARENT   min   max   mean   median   
#>   RS2023   1     1     1      1         
#> 
#> Hash: 1ffeca348395517147567cedfdd41e68
#> Last DTC: 2001-03-02 11:31:00

invisible(capture.output(
  summary(nif) %>%
    plot()
))
```

![](reference/figures/README-unnamed-chunk-4-1.png)![](reference/figures/README-unnamed-chunk-4-2.png)![](reference/figures/README-unnamed-chunk-4-3.png)![](reference/figures/README-unnamed-chunk-4-4.png)![](reference/figures/README-unnamed-chunk-4-5.png)![](reference/figures/README-unnamed-chunk-4-6.png)![](reference/figures/README-unnamed-chunk-4-7.png)![](reference/figures/README-unnamed-chunk-4-8.png)![](reference/figures/README-unnamed-chunk-4-9.png)

# Further information

For further guidance see the help for individual functions and the
[project website](https://rstrotmann.github.io/nif/) on github pages.

# Package index

## All functions

- [`add_administration()`](add_administration.md) : Append
  administration events

- [`add_ae_observation()`](add_ae_observation.md) **\[experimental\]** :
  Add AE observation

- [`add_baseline()`](add_baseline.md) : Attach baseline covariate from
  SDTM domain

- [`add_bl_crcl()`](add_bl_crcl.md) : Add baseline creatinine clearance
  field.

- [`add_bl_lbm()`](add_bl_lbm.md) : Add baseline lean body mass (LBM)

- [`add_bl_odwg()`](add_bl_odwg.md) : Add baseline hepatic function
  class

- [`add_bl_renal()`](add_bl_renal.md) : Add baseline renal function
  class

- [`add_cfb()`](add_cfb.md) **\[deprecated\]** : Add baseline and change
  from baseline fields

- [`add_covariate()`](add_covariate.md) : Attach time-varying covariate

- [`add_dd()`](add_dd.md) : Add Field definition to Data Definition
  Table

- [`add_dose_level()`](add_dose_level.md) :

  Add dose level (`DL`) column

- [`add_ntile()`](add_ntile.md) : Add n-tiles (quantiles) for a
  specified column across all subjects

- [`add_obs_per_dosing_interval()`](add_obs_per_dosing_interval.md) :
  Add the number of observations per dosing interval

- [`add_observation()`](add_observation.md) : Append observation events

- [`add_rtb()`](add_rtb.md) **\[deprecated\]** : Add baseline and
  relative-to-baseline fields

- [`add_tad()`](add_tad.md) : Add time-after-dose (TAD) field

- [`add_time_deviation()`](add_time_deviation.md) **\[experimental\]** :
  Calculate time deviations for observations

- [`add_time_window_flag()`](add_time_window_flag.md)
  **\[experimental\]** : Flag time window violations

- [`add_trtdy()`](add_trtdy.md) : Add treatment day ('TRTDY') column

- [`administration_summary()`](administration_summary.md) : Overview on
  the number of administrations in the subjects by parent

- [`ae_summary()`](ae_summary.md) : AE summary

- [`analyte_overview()`](analyte_overview.md) : Overview on analytes and
  parents

- [`analytes()`](analytes.md) : Analytes within a NIF or SDTM object

- [`apply_cat_filter()`](apply_cat_filter.md) : Apply CAT and SCAT
  filter

- [`as_nif()`](as_nif.md) : Convert data frame to nif object

- [`coalesce_join()`](coalesce_join.md) : Coalescing join

- [`compartments()`](compartments.md) : Compartments used in a nif
  object

- [`correlate_obs()`](correlate_obs.md) **\[experimental\]** : Correlate
  observations

- [`covariate_barplot()`](covariate_barplot.md) : Generic covariate
  barplot

- [`covariate_hist()`](covariate_hist.md) : Generic covariate
  distribution histogram

- [`crea_mdrd()`](crea_mdrd.md) : Serum creatinine estimation from eGFR
  (MDRD)

- [`crea_raynaud()`](crea_raynaud.md) : Serum creatinine estimation from
  eGFR (Raynaud method)

- [`ddt()`](ddt.md) : Data definition table for NIF object

- [`derive_baseline()`](derive_baseline.md) : Extract the individual
  baseline value for an analyte

- [`derive_cfb()`](derive_cfb.md) : Extract the individual baseline
  value and change from baseline for an analyte

- [`derive_cfb_analyte()`](derive_cfb_analyte.md) : Derive a new analyte
  with change from baseline from an existing analyte

- [`derive_sld()`](derive_sld.md) **\[experimental\]** : Calculate SLD
  for SDTM.TR domain

- [`disposition_summary()`](disposition_summary.md) : Subject
  disposition overview

- [`domain()`](domain.md) : Return a specific domain from a sdtm object

- [`domain_model`](domain_model.md) : SDTM Domain Model variables

- [`dose_levels()`](dose_levels.md) : Dose levels within a NIF object

- [`dose_lin()`](dose_lin.md) **\[experimental\]** : Test for dose
  linearity

- [`dose_red_sbs()`](dose_red_sbs.md) : Subjects with dose reduction

- [`doses()`](doses.md) : Doses in a nif or sdtm object

- [`dv_na_to_zero()`](dv_na_to_zero.md) : Set all NA values in DV to
  zero

- [`edish_plot()`](edish_plot.md) : Drug-induced serious hepatotoxicity
  (eDISH) plot

- [`egfr_cg()`](egfr_cg.md) : Glomerular filtration rate estimation from
  serum creatinine (Cockcroft-Gault)

- [`egfr_mdrd()`](egfr_mdrd.md) : Glomerular filtration rate estimation
  from serum creatinine (MDRD)

- [`egfr_raynaud()`](egfr_raynaud.md) : Glomerular filtration rate
  estimation from serum creatinine (Raynaud method)

- [`examplinib_fe`](examplinib_fe.md) : Synthetic SDTM data from a
  fictional clinical food effect study for 'examplinib'.

- [`examplinib_fe_nif`](examplinib_fe_nif.md) : Synthetic NIF data from
  a fictional clinical food effect study for 'examplinib'.

- [`examplinib_poc`](examplinib_poc.md) : Synthetic SDTM data from a
  fictional clinical single-arm study with rich and sparse pk sampling.

- [`examplinib_poc_min_nif`](examplinib_poc_min_nif.md) : Synthetic NIF
  data from a fictional clinical single-arm study with rich and sparse
  pk sampling. Reduced to the minimally required fields.

- [`examplinib_poc_nif`](examplinib_poc_nif.md) : Synthetic NIF data
  from a fictional clinical single-arm study with rich and sparse pk
  sampling.

- [`examplinib_sad`](examplinib_sad.md) : Synthetic SDTM data from a
  fictional clinical SAD FIH study with rich PK sampling

- [`examplinib_sad_min_nif`](examplinib_sad_min_nif.md) : Synthetic NIF
  data from a fictional clinical SAD FIH study with rich PK sampling.
  Reduced to the minimally required fields.

- [`examplinib_sad_nif`](examplinib_sad_nif.md) : Synthetic NIF data
  from a fictional clinical SAD FIH study with rich PK sampling

- [`filter_EXENDTC_after_EXSTDTC()`](filter_EXENDTC_after_EXSTDTC.md) :
  Remove administrations with EXSTDTC after EXENDTC

- [`filter_subject()`](filter_subject.md) : Keep only selected USUBJID
  in the data set

- [`find_duplicates()`](find_duplicates.md) : Find duplicate rows in a
  data frame

- [`get_pinboard()`](get_pinboard.md) : Get pinboard object

- [`hash.sdtm()`](hash.sdtm.md) : Generate the XXH128 hash of a sdtm
  object

- [`identify_baseline_columns()`](identify_baseline_columns.md) :
  Identify baseline columns in a data frame

- [`import_from_connection()`](import_from_connection.md) : Import nif
  object from connection

- [`import_nif()`](import_nif.md) : Import nif file

- [`import_observation()`](import_observation.md) **\[experimental\]** :
  Add observation from non-SDTM-formatted data table

- [`impute_exendtc_to_cutoff()`](impute_exendtc_to_cutoff.md) : Impute
  last EXENDTC per subject and treatment to cutoff date when absent.

- [`impute_exendtc_to_rfendtc()`](impute_exendtc_to_rfendtc.md) : Impute
  very last EXENDTC for a subject and EXTRT to RFENDTC, if absent

- [`impute_missing_exendtc()`](impute_missing_exendtc.md) : Impute
  missing EXENDTC to the day before the next EXSTDTC.

- [`index_dosing_interval()`](index_dosing_interval.md) : Index dosing
  intervals

- [`index_rich_sampling_intervals()`](index_rich_sampling_intervals.md)
  : Identify and index rich PK sampling intervals

- [`last_dtc()`](last_dtc.md) : Last recorded date-time

- [`lbm_boer()`](lbm_boer.md) : Lean body mass (Boer formula)

- [`lbm_hume()`](lbm_hume.md) : Lean body mass (Hume formula)

- [`lbm_peters()`](lbm_peters.md) : Lean body mass (Peters formula)

- [`legacy_add_cfb()`](legacy_add_cfb.md) **\[deprecated\]** : Add
  baseline and change from baseline fields

- [`limit()`](limit.md) : Subset nif to rows with DTC before the last
  individual or global observation

- [`make_ntime()`](make_ntime.md) : Make nominal time

- [`make_ntime_from_dy()`](make_ntime_from_dy.md) : Make ntime lookup
  table from DY field

- [`make_ntime_from_tpt()`](make_ntime_from_tpt.md) : Convert time point
  text to numeric time values

- [`make_ntime_from_tptnum()`](make_ntime_from_tptnum.md) : Make ntime
  lookup table from TPTNUM field

- [`make_ntime_from_visitdy()`](make_ntime_from_visitdy.md) : Make ntime
  lookup table from VISITDY field

- [`make_subjects_sdtm()`](make_subjects_sdtm.md) : Make subject data
  frame from SDTM object

- [`make_time()`](make_time.md) : Calculate time fields based on DTC

- [`max_admin_time()`](max_admin_time.md) : Maximal administration time

- [`max_observation_time()`](max_observation_time.md) : Maximal
  observation time

- [`max_time()`](max_time.md) : Maximal time in nif object

- [`minimal_nif_fields`](minimal_nif_fields.md) : Minimal nif fields

- [`n_administrations()`](n_administrations.md) : Number of
  administrations per subject

- [`nca()`](nca.md) : Non-compartmental analysis

- [`nca1()`](nca1.md) **\[experimental\]** : Non-compartmental analysis
  of NIF data

- [`nca2()`](nca2.md) : Non-compartmental analysis with analyte-based
  grouping

- [`nca_from_pp()`](nca_from_pp.md) : Generate NCA table from the
  SDTM.PP domain

- [`nca_power_model()`](nca_power_model.md) **\[experimental\]** : Power
  fit for PK parameters

- [`nca_summary()`](nca_summary.md) : PK parameter summary statistics by
  dose

- [`nca_summary_table()`](nca_summary_table.md) : PK parameter summary
  statistics table by dose

- [`new_nif()`](new_nif.md) : nif class constructor

- [`new_sdtm()`](new_sdtm.md) : SDTM class constructor, creating a sdtm
  object from a set of SDTM domains

- [`nif()`](nif.md) : nif class constructor

- [`nif_auto()`](nif_auto.md) **\[experimental\]** : Auto-generate nif
  from sdtm object

- [`nif_disclaimer()`](nif_disclaimer.md) : Disclaimer statement

- [`nif_nca_new()`](nif_nca_new.md) : Perform Non-Compartmental Analysis
  (NCA) for each subject and analyte

- [`nif_option()`](nif_option.md) : Set or get global options

- [`nif_pinboard()`](nif_pinboard.md) : Get or set pinboard path

- [`nif_viewer()`](nif_viewer.md) : NIF viewer

- [`normalize_nif()`](normalize_nif.md) : Normalize nif object

- [`obs_per_dose_level()`](obs_per_dose_level.md) : Observations per
  dose level

- [`parents()`](parents.md) : Parent compounds within a NIF object

- [`pb_list_nif()`](pb_list_nif.md) **\[experimental\]** : List nif
  objects in pinboard

- [`pb_list_object()`](pb_list_object.md) **\[experimental\]** : List
  contents of pinboard

- [`pb_list_sdtm()`](pb_list_sdtm.md) **\[experimental\]** : List sdtm
  objects in pinboard

- [`pb_read_nif()`](pb_read_nif.md) **\[experimental\]** : Read nif
  object from pinboard

- [`pb_read_sdtm()`](pb_read_sdtm.md) **\[experimental\]** : Read sdtm
  object from pinboard

- [`pb_write()`](pb_write.md) **\[experimental\]** : Generic pin_write
  function

- [`pb_write(`*`<nif>`*`)`](pb_write.nif.md) **\[experimental\]** :
  Write to pin board

- [`pb_write(`*`<sdtm>`*`)`](pb_write.sdtm.md) **\[experimental\]** :
  Write to pin board

- [`plot(`*`<domain>`*`)`](plot.domain.md) : Plot domain object

- [`plot(`*`<nif>`*`)`](plot.nif.md) : Plot NIF object.

- [`plot(`*`<sdtm>`*`)`](plot.sdtm.md) : Plot SDTM object

- [`print_debug()`](print_debug.md) : Debug output

- [`race_coding`](race_coding.md) : Race coding table

- [`read_sdtm()`](read_sdtm.md) : Read SDTM data

- [`recode_race()`](recode_race.md) : Recode RACE columns in nif object

- [`resolve_duplicates()`](resolve_duplicates.md) : Resolve duplicate
  rows by averaging DV and setting conflicting fields to NA

- [`rich_sampling_sbs()`](rich_sampling_sbs.md) : Identify subjects with
  rich sampling

- [`sampling_summary()`](sampling_summary.md) : Sampling scheme overview

- [`sdtm_missing_times()`](sdtm_missing_times.md) : Number of DTC
  entries with missing time information

- [`standard_nif_fields`](standard_nif_fields.md) : Standard nif fields

- [`standardize_date_format()`](standardize_date_format.md) : Convert
  date fields to POSIX format

- [`studies()`](studies.md) : Studies within a nif object

- [`subject_info()`](subject_info.md) : Baseline details for specific
  subjects

- [`subjects()`](subjects.md) : Unique subjects within a data set

- [`subs_per_dose_level()`](subs_per_dose_level.md) : Subjects per dose
  level

- [`suggest()`](suggest.md) : Suggest data programming steps to generate
  a nif object from an sdtm object

- [`testcd()`](testcd.md) : Extract TESTCD fields by domain from a sdtm
  object

- [`treatments()`](treatments.md) : Treatments in a nif or sdtm object

- [`trial_dco()`](trial_dco.md) : Trial data cut-off date as reported in
  TS domain

- [`trial_title()`](trial_title.md) : Trial title as reported in TS
  domain

- [`usubjid()`](usubjid.md) : Get the USUBJID of subject

- [`watermark()`](watermark.md) : Add a watermark annotation layer for a
  ggplot2 object

- [`write_monolix()`](write_monolix.md) : Write as comma-separated file,
  complying with the format used by Monolix

- [`write_nonmem()`](write_nonmem.md) : Write NONMEM input formatted nif
  object to file

# Articles

### Articles

- [Creating NIF files from SDTM data](nif-tutorial.md):
- [Example: Multiple-dose study](multiple-dose-example.md):
- [Imputations and assumptions](nif-imputations.md):
- [Multiple studies in one NIF](multiple-study-example.md):
- [NIF data definition using formulae](nif-formulas.md):
